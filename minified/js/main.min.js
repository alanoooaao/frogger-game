!function(){"use strict";function e(e){e instanceof Array?e.forEach(function(e){t(e)}):t(e)}function t(e){if(o[e])return o[e];var t=new Image;t.onload=function(){o[e]=t,a()&&i.forEach(function(e){e()})},o[e]=!1,t.src=e}function n(e){return o[e]}function a(){var e=!0;for(var t in o)o.hasOwnProperty(t)&&!o[t]&&(e=!1);return e}function r(e){i.push(e)}var o={},i=[];window.Resources={load:e,get:n,onReady:r,isReady:a}}();var Enemy=function(e){"use strict";this.level=e,this.initLocation(),this.sprite="images/enemy-bug.png"};Enemy.prototype.initLocation=function(){"use strict";this.x=-CELL_WIDTH,this.y=CELL_HEIGHT*Math.ceil(4*Math.random());var e=36;e=this.level<36?36+1*this.level:this.level<72?72+.95*(this.level-36):this.level<108?72+36*.95+.88*(this.level-72):this.level<144?137.88+.77*(this.level-108):165.6+.6*(this.level-144),this.speed=e*(2+3*Math.random())},Enemy.prototype.update=function(e){"use strict";this.x+=this.speed*e,this.x>5*CELL_WIDTH&&this.initLocation()},Enemy.prototype.render=function(){"use strict";ctx.drawImage(Resources.get(this.sprite),this.x+20,this.y-20,60,102)};var Entity=function(){"use strict";this.initLocation()};Entity.prototype.initLocation=function(){"use strict";var e,t;do{e=Math.floor(5*Math.random()),t=Math.floor(4*Math.random()),this.x=CELL_WIDTH*e,this.y=CELL_HEIGHT*(t+1)}while(Controller.pavement[t][e]||this.x===player.x&&this.y===player.y);Controller.pavement[t][e]=!0};var Obstacle=function(){"use strict";Entity.call(this),this.sprite="images/Rock.png"};Obstacle.prototype=Object.create(Entity.prototype),Obstacle.prototype.constructor=Obstacle,Obstacle.prototype.render=function(){"use strict";ctx.drawImage(Resources.get(this.sprite),this.x+10,this.y-40,80,136)};var Treasure=function(){"use strict";Entity.call(this)};Treasure.prototype=Object.create(Entity.prototype),Treasure.prototype.constructor=Treasure,Treasure.prototype.render=function(){"use strict";ctx.drawImage(Resources.get(this.sprite),this.x+21,this.y-15,60,102)};var BlueGem=function(){"use strict";Treasure.call(this),this.sprite="images/Gem Blue.png"};BlueGem.prototype=Object.create(Treasure.prototype),BlueGem.prototype.constructor=BlueGem;var GreenGem=function(){"use strict";Treasure.call(this),this.sprite="images/Gem Green.png"};GreenGem.prototype=Object.create(Treasure.prototype),GreenGem.prototype.constructor=GreenGem;var OrangeGem=function(){"use strict";Treasure.call(this),this.sprite="images/Gem Orange.png"};OrangeGem.prototype=Object.create(Treasure.prototype),OrangeGem.prototype.constructor=OrangeGem;var Heart=function(){"use strict";Treasure.call(this),this.sprite="images/Heart.png"};Heart.prototype=Object.create(Treasure.prototype),Heart.prototype.constructor=Heart,Heart.prototype.render=function(){"use strict";ctx.drawImage(Resources.get(this.sprite),this.x+21,this.y-5,60,102)};var Key=function(){"use strict";Treasure.call(this),this.sprite="images/Key.png"};Key.prototype=Object.create(Treasure.prototype),Key.prototype.constructor=Key,Key.prototype.render=function(){"use strict";ctx.drawImage(Resources.get(this.sprite),this.x+12,this.y-30,80,136)};var Star=function(){"use strict";Treasure.call(this),this.sprite="images/Star.png"};Star.prototype=Object.create(Treasure.prototype),Star.prototype.constructor=Star;var Player=function(){"use strict";var e=["images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png"],t=Math.floor(Math.random()*e.length);this.sprite=e[t],this.lives=3,this.score=0,this.canMove=!0,this.initLocation()};Player.prototype.initLocation=function(){"use strict";this.x=2*CELL_WIDTH,this.y=5*CELL_HEIGHT},Player.prototype.update=function(){"use strict";this.canMove&&this.hasCollisionWith(allEnemies)&&Controller.collideWithEnemy()},Player.prototype.hasCollisionWith=function(e){"use strict";if(!(e instanceof Array))return console.log("not an array!"),!1;for(var t=0;t<e.length;t++){var n=e[t];if(void 0!==n&&null!==n&&n.hasOwnProperty("x")&&n.hasOwnProperty("y")){if(n instanceof Enemy&&Math.abs(this.x-n.x)<50&&this.y===n.y)return!0;if(n instanceof Obstacle&&this.x===n.x&&this.y===n.y)return!0;if(n instanceof Treasure&&this.x===n.x&&this.y===n.y){n instanceof BlueGem?Controller.obtainBlueGem():n instanceof GreenGem?Controller.obtainGreenGem():n instanceof OrangeGem?Controller.obtainOrangeGem():n instanceof Heart?Controller.obtainHeart():n instanceof Key?Controller.obtainKey():n instanceof Star&&Controller.obtainStar(),e[t]=null,allTreasure=Util.takeOutNullOrUndefined(e);var a=this.y/CELL_HEIGHT-1,r=this.x/CELL_WIDTH;return Controller.pavement[a][r]=!1,!0}}}return!1},Player.prototype.render=function(){"use strict";ctx.drawImage(Resources.get(this.sprite),this.x,this.y-50)},Player.prototype.handleInput=function(e){"use strict";if(this.canMove){var t=this.x,n=this.y;switch(e){case"left":this.x>=CELL_WIDTH&&(this.x-=CELL_WIDTH);break;case"right":this.x<4*CELL_WIDTH&&(this.x+=CELL_WIDTH);break;case"up":this.y>0&&(this.y-=CELL_HEIGHT,this.y<=0&&Controller.crossRiver());break;case"down":this.y<5*CELL_HEIGHT&&(this.y+=CELL_HEIGHT);break;default:return}this.hasCollisionWith(allObstacles)&&(this.x=t,this.y=n),this.hasCollisionWith(allTreasure)}};var Util=function(e){"use strict";var t=function(e){for(var t=[],n=0,a=0;n<e.length;n++)null!==e[n]&&void 0!==e[n]&&(t[a]=e[n],a++);return t};return{takeOutNullOrUndefined:t,StorageGetter:function(t){var n=e.localStorage.getItem("frogger_game_"+t);return JSON.parse(n)},StorageSetter:function(t,n){var a=JSON.stringify(n);return e.localStorage.setItem("frogger_game_"+t,a)}}}(this),Controller=function(e){"use strict";var t,n,a={treasureNum:2,obstacleNum:2,enemyNum:5,enemyLevel:1},r=function(){var e=[];return e.reset=function(){for(var t=0;t<4;t++){e[t]=[];for(var n=0;n<5;n++)e[t][n]=!1}},e.getOccupiedNum=function(){var e=0;return this.forEach(function(t){t.forEach(function(t){e+=t?1:0})}),e},e.reset(),e}(),o=function(e,t){allEnemies.length>0&&(t=allEnemies[0].level);for(var n=0;n<e;n++)allEnemies.push(new Enemy(t))},i=function(e){for(var t=0;t<e;t++)r.getOccupiedNum()<=10&&allObstacles.push(new Obstacle)},s=function(e,t){for(var n=0;n<e;n++)r.getOccupiedNum()<=12&&allTreasure.push(new t)},l=function(e){var t,n,a=[{ClassName:BlueGem,weight:20},{ClassName:GreenGem,weight:10},{ClassName:OrangeGem,weight:15},{ClassName:Heart,weight:10},{ClassName:Key,weight:10},{ClassName:Star,weight:5}],r=0;for(t=0;t<a.length;t++)r+=a[t].weight;var o,i,l;for(t=0;t<e;t++){for(o=Math.ceil(Math.random()*r),l=a[0].ClassName,i=0,n=0;n<a.length-1;n++)(i+=a[n].weight)<o&&(l=a[n+1].ClassName);s(1,l)}},c=function(){if(0!==allObstacles.length){var e=Math.floor(Math.random()*allObstacles.length),t=allObstacles[e].y/CELL_HEIGHT-1,n=allObstacles[e].x/CELL_WIDTH;r[t][n]=!1,allObstacles[e]=null,allObstacles=Util.takeOutNullOrUndefined(allObstacles)}},g=function(){player.initLocation(),player.lives=3,player.score=0,player.canMove=!0,DomManager.updateLives(),DomManager.updateScore(),DomManager.resetMsg(),DomManager.hideMenu(),d(),D(),DomManager.setProgressBarLength(0),Engine.reset(),h(a.treasureNum,a.obstacleNum,a.enemyNum,a.enemyLevel),f=0,y()},u=function(){player.canMove=!1,Engine.setTimeSpeed(0),x()},m=function(){player.canMove=!0,Engine.setTimeSpeed(1),T>0&&C()},p=function(){d(),D();var t=["Game Over","游戏结束！"];DomManager.setMsg(t[language]),e.setTimeout(function(){var t=Date.now(),n={name:"",score:player.score,role:player.sprite,time:t},a=Data.getLocalList(),r=Data.getRemoteList(),o=r.length<100||n.score>r[99].score,i=a.length<10||n.score>a[9].score,s=["小猫","小狗","小老鼠","小牛","小老虎","小兔子","小羊羔","小猴子","小猪","小熊猫","小苹果"],l=Math.floor(Math.random()*s.length),c="没有名字的"+s[l];if(o){var u=["Congratulations! You've broaded on the global record list!Please leave your name: ","恭喜，你成功登上了全球排行榜！\n请留下你的大名："];n.name=e.prompt(u[language],c)||c,Data.updateRemoteList(n),Data.updateLocalList(n)}else if(i){var m=["You have freshed your own top 10 records!\nPlease leave your name: ","你刷新了个人的10佳记录，可以留个名了："];n.name=e.prompt(m[language],c)||c,Data.updateLocalList(n)}else{var p=["You could do better!","下次努力"];e.alert(p[language])}g()},10)},h=function(e,t,n,a){allEnemies=[],allObstacles=[],allTreasure=[],r.reset(),l(e),i(t),o(n,a)},f=0,y=function(){var n=f;e.clearInterval(t),t=e.setInterval(function(){var e=Engine.getTime()/5,t=1.25*Math.sqrt(player.score);f=Math.floor(Math.min(e,t)),f!==n&&(allEnemies.forEach(function(e){e.level+=1}),l(1),f%3==0&&(allEnemies.length<4&&o(1,f),i(1)),f%4==0&&allEnemies.length<8&&o(1,f),f%6==0&&s(1,Key),f%8==0&&s(1,GreenGem),f%12==0&&s(1,Heart)),n=f},1e3)},d=function(){e.clearInterval(t)},v=0,E=1,M=0,b=function(){e.clearTimeout(M),player.canMove=!1;var t=Date.now();E=t-v<2800?E<4?E+1:4:1;var n=(10+f)*E;player.score+=n,DomManager.updateScore();var a=[];a[0]=["Good Job!","Nice Move!","Well Done!","You Need Water!"],a[1]=["好样的！","身手敏捷！","你的身法让人眼花缭乱","该让甲虫跑得再快一点","甲虫朋友们，碾死他！"];var r=Math.floor(Math.random()*a[language].length),o=["Fast Crossing\n"+E+" * "+n+" Scores Awarded","连续过河! "+E+"倍积分奖励"];E>1?(DomManager.setMsg(o[language]),DomManager.setMsgColor("#fbf850")):DomManager.setMsg(a[language][r]),v=Date.now(),e.setTimeout(function(){player.initLocation(),player.canMove=!0},500),M=e.setTimeout(function(){DomManager.resetMsg()},1500)},L=function(){if(u(),player.lives-=1,DomManager.updateLives(),DomManager.setMsgColor("#f13"),player.lives>0){var t=["Oops! Collide with a bug!","你被甲虫给逮住啦!"];DomManager.setMsg(t[language]),e.setTimeout(function(){DomManager.resetMsg(),player.initLocation(),m()},1500)}else p()},I=function(){T=5e3,C()},T=0,C=function(){Engine.setTimeSpeed(.2);var t=["Time Slowing Down","时间变慢了！"];DomManager.setMsg(t[language]);T=Math.min(5e3,T);e.clearInterval(n),n=e.setInterval(function(){T-=10,T=Math.max(T-10,0),DomManager.setProgressBarLength(T/5e3),T<=0&&(Engine.setTimeSpeed(1),DomManager.resetMsg(),e.clearInterval(n))},10)},x=function(){e.clearInterval(n)},D=function(){e.clearInterval(n),T=0,DomManager.setProgressBarLength(0)},G=function(){if(allEnemies.length<=1){var t=30+2*f;player.score+=t,DomManager.updateScore();var n=[" Scores Awarded!","分到手！"];DomManager.setMsg(t+n[language])}else{var a=allEnemies.length>2&&f>60?2:1;allEnemies=allEnemies.slice(0,allEnemies.length-a);var r=[" Bug Eliminated!","只甲虫被消灭！"];DomManager.setMsg(a+r[language])}e.setTimeout(function(){DomManager.resetMsg()},1500)},w=function(){allEnemies.forEach(function(e){e.x=-200});var t=["Push Bugs Away!!","全部给我闪开！"];DomManager.setMsg(t[language]),e.setTimeout(function(){DomManager.resetMsg()},1500)},B=function(){if(player.lives<5){player.lives+=1,DomManager.updateLives();var t=["One More Life!","奖励1点生命值"];DomManager.setMsg(t[language])}else{var n=50+2*f;player.score+=n,DomManager.updateScore();var a=["分到手！"," Extra Scores"];DomManager.setMsg(player.score+a[language])}e.setTimeout(function(){DomManager.resetMsg()},1500)},O=function(){c(),player.score+=20+Math.floor(.5*f),DomManager.updateScore();var t=["Remove a Rock!","移开了一块石头!"];DomManager.setMsg(t[language]),e.setTimeout(function(){DomManager.resetMsg()},1500)},k=function(){var t=100+3*f;player.score+=t,DomManager.updateScore();var n=[" Scores Awarded!","分到手，好多!"];DomManager.setMsg(t+n[language]),e.setTimeout(function(){DomManager.resetMsg()},1500)};return{pavement:r,initialSettings:a,restartGame:g,pauseGame:u,continueGame:m,crossRiver:b,collideWithEnemy:L,obtainBlueGem:I,obtainGreenGem:G,obtainOrangeGem:w,obtainKey:O,obtainHeart:B,obtainStar:k}}(this);DomManager=function(e){"use strict";var t=e.document,n=t.getElementById("score"),a=t.getElementById("msg"),r=t.getElementById("life"),o=t.getElementById("progress-bar"),i=t.getElementById("top-bar"),s=t.getElementById("btn-menu"),l=t.getElementById("menu"),c=t.getElementById("btn-ranking"),g=t.getElementById("title-world"),u=t.getElementById("title-local"),m=t.getElementById("ranking-board"),p=t.getElementById("remote-list"),h=t.getElementById("local-list"),f=t.getElementById("btn-close-ranking"),y=t.getElementById("btn-instruction"),d=t.getElementById("instruction-board"),v=t.getElementById("btn-close-instruction"),E=t.getElementById("btn-role"),M=t.getElementById("role-list"),b=t.getElementById("btn-language"),L=t.getElementById("language-list"),I=t.getElementById("btn-restart"),T=t.getElementById("operation-panel"),C=t.getElementById("arrow-up"),x=t.getElementById("arrow-down"),D=t.getElementById("arrow-left"),G=t.getElementById("arrow-right"),w=function(){var e=["Frogger","扶小朋友过马路"];t.getElementById("game-title").innerText=e[language];var n=["Ranking","排行榜"];c.innerText=n[language];var a=["Role","角色"];E.innerText=a[language];var r=["Language","语言"];b.innerText=r[language];var o=["Instruction","游戏说明"];y.innerText=o[language];var i=["Restart","重新开始"];I.innerText=i[language];var s=["World","全球榜单"];g.innerText=s[language];var l=["Local","本地榜单"];u.innerText=l[language]},B=function(){var e=["Move to the river above","快到河边来！"];a.innerText=e[language],a.style.color="#fff"},O=function(e){a.innerText=e},k=function(e){a.style.color=e},H=function(){var e=["Score: ","分数: "];n.innerText=e[language]+player.score},S=function(){r.innerText="";for(var e=0;e<player.lives;e++)r.innerText+="♥"},N=function(e){e=Math.max(e,0),e=Math.min(e,1),o.style.width=i.offsetWidth*e+"px"},P=!0,_=function(){l.style.height="303px",l.style.borderBottom="2px solid #251",P=!1,Controller.pauseGame()},W=function(){l.style.height=0,l.style.borderBottom=0,P=!0,Controller.continueGame()},R=!0,K=function(){M.style.width="310px",R=!1},A=function(){M.style.width="0",R=!1},U=!0,j=function(){L.style.width="204px",U=!1},Y=function(){L.style.width="0",U=!1},F=function(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0,a=0;a<t.length;a++)if(e.indexOf(t[a])>0){n=!1;break}return n},J=function(){w(),t.addEventListener("keyup",function(e){var t={37:"left",38:"up",39:"right",40:"down"};player.handleInput(t[e.keyCode])}),s.onclick=function(e){e.stopPropagation(),P?_():W()},t.onclick=function(){W(),A(),Y()},m.style.height=t.documentElement.clientHeight+"px";var e,n,a=function(n){var a=t.createElement("li"),r=e%2==0?"odd-row":"even-row";a.className="record "+r;var o=t.createElement("p");o.className="record-ranking record-txt",o.id=n+"ranking-"+e;var i=t.createElement("div");i.className="record-role";var s=t.createElement("img");s.className="role-img",s.id=n+"img-"+e,i.appendChild(s);var l=t.createElement("p");l.className="record-name record-txt",l.id=n+"name-"+e;var c=t.createElement("p");return c.className="record-score record-txt",c.id=n+"score-"+e,a.appendChild(o),a.appendChild(i),a.appendChild(l),a.appendChild(c),a};for(e=0;e<100;e++)n=a("remote-"),p.appendChild(n);for(e=0;e<10;e++)n=a("local-"),h.appendChild(n);c.onclick=function(e){e.stopPropagation(),W(),Controller.pauseGame(),m.style.display="block",Data.uploadLocalList();var n,a,r,o,i,s,l=Data.getRemoteList(),c=Data.getLocalList(),g=Math.min(l.length,100);for(n=0;n<g;n++)a=l[n],r=t.getElementById("remote-ranking-"+n),o=t.getElementById("remote-img-"+n),i=t.getElementById("remote-name-"+n),s=t.getElementById("remote-score-"+n),r.innerText=n+1,o.src=a.role||"images/char-boy.png",o.alt=o.src,i.innerText=a.name,s.innerText=a.score;var u=Math.min(c.length,10);for(n=0;n<u;n++)a=c[n],r=t.getElementById("local-ranking-"+n),o=t.getElementById("local-img-"+n),i=t.getElementById("local-name-"+n),s=t.getElementById("local-score-"+n),r.innerText=n+1,o.src=a.role||"images/char-boy.png",o.alt=o.src,i.innerText=a.name,s.innerText=a.score},g.onclick=function(e){e.stopPropagation(),g.style.backgroundColor="#4156a0",u.style.backgroundColor="transparent",p.style.left="0",h.style.left=p.offsetWidth+"px"},u.onclick=function(e){e.stopPropagation(),u.style.backgroundColor="#4156a0",g.style.backgroundColor="transparent",p.style.left=-p.offsetWidth+"px",h.style.left="0"},f.onclick=function(){m.style.display="none"},E.onclick=function(e){e.stopPropagation()},b.onclick=function(e){e.stopPropagation()},E.onmouseover=function(){K()},M.onmouseover=function(){K()},E.onmouseout=function(){A()},M.onmouseout=function(){A()},d.style.height=t.documentElement.clientHeight+"px",y.onclick=function(e){e.stopPropagation(),W(),Controller.pauseGame(),d.style.display="block"},v.onclick=function(){d.style.display="none"};for(var r=["images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png"],o=0;o<r.length;o++){var i=t.getElementById("role-"+o);i.src=r[o],function(e){i.onclick=function(){player.sprite=r[e],A()}}(o)}b.onmouseover=function(){j()},L.onmouseover=function(){j()},b.onmouseout=function(){Y()},L.onmouseout=function(){Y()};var l=t.getElementById("language-0"),O=t.getElementById("language-1");if(l.onclick=function(){language=0,w(),B(),H(),Util.StorageSetter("language",language)},O.onclick=function(){language=1,w(),B(),H(),Util.StorageSetter("language",language)},I.onclick=function(){Controller.restartGame()},F())T.style.display="none";else{T.style.display="block",C.ontouchstart=function(){player.handleInput("up")},x.ontouchstart=function(){player.handleInput("down")},D.ontouchstart=function(){player.handleInput("left")},G.ontouchstart=function(){player.handleInput("right")},t.addEventListener("touchstart",function(e){e.touches.length>1&&e.preventDefault()});var k=0;t.addEventListener("touchend",function(e){var t=(new Date).getTime();t-k<=500&&e.preventDefault(),k=t},!1)}};return{resetMsg:B,setMsg:O,setMsgColor:k,updateScore:H,updateLives:S,setProgressBarLength:N,hideMenu:W,addEventListener:J}}(this);var CELL_WIDTH=101,CELL_HEIGHT=83,player=new Player,allEnemies=[],allObstacles=[],allTreasure=[],language=Util.StorageGetter("language");void 0!==language&&null!==language||(language=1);var Engine=function(e){"use strict";function t(){var e=Date.now(),n=(e-g)/1e3*y;a(n),o(),g=e,u+=n,p.requestAnimationFrame(t)}function n(){Controller.restartGame(),DomManager.addEventListener(),g=Date.now(),t()}function a(e){r(e)}function r(e){allEnemies.forEach(function(t){t.update(e)}),player.update()}function o(){var e,t,n=["images/water-block.png","images/stone-block.png","images/stone-block.png","images/stone-block.png","images/stone-block.png","images/grass-block.png"];for(e=0;e<6;e++)for(t=0;t<5;t++)f.drawImage(Resources.get(n[e]),t*CELL_WIDTH,e*CELL_HEIGHT-40);i()}function i(){allEnemies.forEach(function(e){e.render()}),allObstacles.forEach(function(e){e.render()}),allTreasure.forEach(function(e){e.render()}),player.render()}function s(){u=0,c(1)}function l(){return u}function c(e){y=e}var g,u,m=e.document,p=e.window,h=m.createElement("canvas"),f=h.getContext("2d"),y=1;return h.width=5*CELL_WIDTH,h.height=6.8*CELL_HEIGHT,m.body.appendChild(h),h.style.marginTop="-11px",Resources.load(["images/stone-block.png","images/water-block.png","images/grass-block.png","images/enemy-bug.png","images/char-boy.png","images/char-cat-girl.png","images/char-horn-girl.png","images/char-pink-girl.png","images/char-princess-girl.png","images/Rock.png","images/Gem Blue.png","images/Gem Green.png","images/Gem Orange.png","images/Heart.png","images/Key.png","images/Star.png"]),Resources.onReady(n),e.ctx=f,{reset:s,getTime:l,setTimeSpeed:c}}(this);